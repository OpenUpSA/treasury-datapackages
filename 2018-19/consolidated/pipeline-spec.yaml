consolidated-expenditure-budget-2018-19:
  title: Consolidated Expenditure Budget 2018-19
  description: Consolidated dataset consisting of national and provincial expenditure on the function group level
  pipeline:

    - run: load
      parameters:
        from: 'https://s3-eu-west-1.amazonaws.com/manual-uploads.vulekamali.gov.za/consolidated/Budget+2018+-+Consolidated+account+Pivot.csv'
        name: 'consolidated-2018-19'
        format: 'csv'
      cache: false

    - run: find_replace
      parameters:
        resources: consolidated-2018-19
        fields:
          - name: 'Fin Year'
            patterns:
              - find: (\d{4})/\d{2}
                replace: \1
          - name: Values
            patterns:
              - find: ','
                replace: ''
              - find: (\d+)\.\d+
                replace: \1
              - find: \(blank\)
                replace: 0
              - find: 0.0
                replace: 0

      cache: false


    - run: set_types
      parameters:
        resources: consolidated-2018-19
        types:
          Values:
            type: number

    - run: multiply
      parameters:
        value_field: 'Values'

    - run: dump_to_path
      parameters:
        out-path: './processed'
        format: 'csv'
