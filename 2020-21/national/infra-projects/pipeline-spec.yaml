featured-national-infra-projects-2020-21:
  title: Featured National Infrastructure Projects 2020-21
  description: National department Infrastructure Projects in South Africa
  pipeline:
  - run: load
    parameters:
      from: "2020-21-match-input-format.xlsx"
      name: 'infra-2020-21'
      format: 'xlsx'
    cache: false

  - run: set_types
    parameters:
      resources: infra-2020-21
      types:
        "Featured":
          type: boolean

  - run: unpivot
    parameters:
      resources: infra-2020-21
      extraKeyFields:
        - name: Financial Year
          type: integer
        - name: Budget Phase
          type: string
      extraValueField:
        name: Amount
        type: number
      unpivot:
        - name: 2016/17
          keys:
            Financial Year: 2016
            Budget Phase: Audited Outcome
        - name: 2017/18
          keys:
            Financial Year: 2017
            Budget Phase: Audited Outcome
        - name: 2018/19
          keys:
            Financial Year: 2018
            Budget Phase: Audited Outcome
        - name: 2019/20 Adjusted Appropriation
          keys:
            Financial Year: 2019
            Budget Phase: Adjusted Appropriation
        - name: 2020/21 Revised baseline
          keys:
            Financial Year: 2020
            Budget Phase: MTEF
        - name: 2021/22 Revised baseline
          keys:
            Financial Year: 2021
            Budget Phase: MTEF
        - name: 2022/23 Revised baseline
          keys:
            Financial Year: 2022
            Budget Phase: MTEF

  - run: add_slug
    parameters:
      new-column-name: "Project slug"
      slug-from-1: "Department"
      slug-from-2: "Project name"

  - run: find_replace
    parameters:
      fields:
        - name: Featured
          patterns:
            - find: true|True
              replace: 'TRUE'

  - run: multiply
    parameters:
      value_field: 'Amount'

  - run: multiply
    parameters:
      value_field: 'Total project cost'

  - run: dump_to_path
    parameters:
      out-path: './processed'
      format: 'csv'
